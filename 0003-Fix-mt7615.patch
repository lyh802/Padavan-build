From 105022e274df0daf29a539d1c6c6ebc90efb2041 Mon Sep 17 00:00:00 2001
From: lyh802 <lyh802@126.com>
Date: Fri, 23 Jun 2023 19:46:01 +0800
Subject: [PATCH 3/3] Fix mt7615

---
 .../boards/MAC2600R/kernel-4.4.x.config       | 64 +++++++-----
 .../wireless/mediatek/mt7615/embedded/Kconfig | 20 ++--
 .../wireless/mediatek/mt7615/embedded/ap/ap.c |  6 +-
 .../mediatek/mt7615/embedded/ap/ap_apcli.c    | 21 +++-
 .../mediatek/mt7615/embedded/ap/ap_assoc.c    |  4 +-
 .../mt7615/embedded/ap/ap_autoChSel.c         |  5 +-
 .../mt7615/embedded/ap/ap_band_steering.c     |  4 +
 .../mediatek/mt7615/embedded/ap/ap_cfg.c      | 22 +++--
 .../mediatek/mt7615/embedded/ap/ap_ftkd.c     |  4 +-
 .../mediatek/mt7615/embedded/ap/apcli_ctrl.c  | 12 ++-
 .../mt7615/embedded/common/cmm_info.c         | 98 +++++++++++++++----
 .../mediatek/mt7615/embedded/common/rrm.c     |  2 +-
 .../mt7615/embedded/common/rt_channel.c       |  8 +-
 .../mediatek/mt7615/embedded/common/txs.c     |  4 +-
 .../mediatek/mt7615/embedded/include/map.h    |  2 +-
 .../mediatek/mt7615/embedded/include/oid.h    |  3 +-
 .../mt7615/embedded/include/rtmp_def.h        |  4 +-
 .../mediatek/mt7615/embedded/mgmt/bss_ops.c   | 33 ++++---
 .../mt7615/embedded/security/crypt_sha2.c     | 44 ++++-----
 .../mediatek/mt7615/include/os/rt_drv.h       |  2 +-
 .../mediatek/mt7615/include/os/rt_linux.h     |  6 +-
 .../mediatek/mt7615/os/linux/rt_linux.c       |  4 +-
 .../net/wireless/mediatek/mt7615_ap/Kconfig   | 28 +++---
 .../net/wireless/mediatek/mt7615_ap/Makefile  | 49 +++++-----
 trunk/linux-4.4.x/include/net/ra_nat.h        |  4 +-
 25 files changed, 287 insertions(+), 166 deletions(-)

diff --git a/trunk/configs/boards/MAC2600R/kernel-4.4.x.config b/trunk/configs/boards/MAC2600R/kernel-4.4.x.config
index ea83fe9f..e0c746c3 100644
--- a/trunk/configs/boards/MAC2600R/kernel-4.4.x.config
+++ b/trunk/configs/boards/MAC2600R/kernel-4.4.x.config
@@ -1442,43 +1442,51 @@ CONFIG_WIFI_MODE_BOTH=m
 #
 CONFIG_CHIP_MT7615E=y
 CONFIG_MT_WIFI=m
+#CONFIG_MT_WIFI_PATH="mt_wifi"
 
 #
 # WiFi Generic Feature Options
 #
+#CONFIG_FIRST_IF_EEPROM_FLASH=y
+# CONFIG_FIRST_IF_EEPROM_EFUSE is not set
+#CONFIG_RT_FIRST_CARD_EEPROM="flash"
+#CONFIG_SECOND_IF_EEPROM_FLASH=y
+# CONFIG_SECOND_IF_EEPROM_PROM is not set
+# CONFIG_SECOND_IF_EEPROM_EFUSE is not set
+#CONFIG_RT_SECOND_CARD_EEPROM="flash"
 CONFIG_MULTI_INF_SUPPORT=y
 CONFIG_WIFI_BASIC_FUNC=y
 CONFIG_DOT11_N_SUPPORT=y
 CONFIG_DOT11_VHT_AC=y
 CONFIG_G_BAND_256QAM_SUPPORT=y
-# CONFIG_TPC_SUPPORT is not set
+#CONFIG_TPC_SUPPORT=y
 CONFIG_ICAP_SUPPORT=y
 CONFIG_SPECTRUM_SUPPORT=y
 CONFIG_BACKGROUND_SCAN_SUPPORT=y
 CONFIG_SMART_CARRIER_SENSE_SUPPORT=y
-# CONFIG_MT_DFS_SUPPORT is not set
+#CONFIG_MT_DFS_SUPPORT=y
 # CONFIG_DPP_SUPPORT is not set
 CONFIG_HDR_TRANS_TX_SUPPORT=y
 CONFIG_HDR_TRANS_RX_SUPPORT=y
 # CONFIG_DBDC_MODE is not set
-# CONFIG_WSC_INCLUDED is not set
-# CONFIG_WSC_V2_SUPPORT is not set
+#CONFIG_WSC_INCLUDED=y
+#CONFIG_WSC_V2_SUPPORT=y
 CONFIG_DOT11W_PMF_SUPPORT=y
 CONFIG_TXBF_SUPPORT=y
-# CONFIG_FAST_NAT_SUPPORT is not set
-# CONFIG_WHNAT_SUPPORT is not set
+CONFIG_FAST_NAT_SUPPORT=y
+#CONFIG_WHNAT_SUPPORT=y
 # CONFIG_FTM_SUPPORT is not set
-# CONFIG_MBO_SUPPORT is not set
+#CONFIG_MBO_SUPPORT=y
 CONFIG_IGMP_SNOOP_SUPPORT=y
 CONFIG_RTMP_FLASH_SUPPORT=y
-CONFIG_PRE_CAL_TRX_SET1_SUPPORT=y
+CONFIG_PRE_CAL_TRX_SET1_SUPPORT=y
 CONFIG_RLM_CAL_CACHE_SUPPORT=y
 CONFIG_PRE_CAL_TRX_SET2_SUPPORT=y
-CONFIG_CAL_BIN_FILE_SUPPORT=y
+CONFIG_CAL_BIN_FILE_SUPPORT=y
 # CONFIG_RF_LOCKDOWN_SUPPORT is not set
-# CONFIG_LINK_TEST_SUPPORT is not set
+#CONFIG_LINK_TEST_SUPPORT=y
 CONFIG_ATE_SUPPORT=y
-# CONFIG_PASSPOINT_R2 is not set
+#CONFIG_PASSPOINT_R2=y
 CONFIG_UAPSD=y
 # CONFIG_TCP_RACK_SUPPORT is not set
 CONFIG_RED_SUPPORT=y
@@ -1491,22 +1499,23 @@ CONFIG_RED_SUPPORT=y
 #
 CONFIG_MT7615_AP=m
 CONFIG_MT_AP_SUPPORT=m
-# CONFIG_WDS_SUPPORT is not set
+#CONFIG_WDS_SUPPORT=y
 # CONFIG_WIFI_EAP_FEATURE is not set
 # CONFIG_MLME_MULTI_QUEUE_SUPPORT is not set
 CONFIG_MBSS_SUPPORT=y
 CONFIG_APCLI_SUPPORT=y
-# CONFIG_APCLI_CERT_SUPPORT is not set
+#CONFIG_APCLI_CERT_SUPPORT=y
 CONFIG_MAC_REPEATER_SUPPORT=y
 # CONFIG_MWDS is not set
 CONFIG_MUMIMO_SUPPORT=y
 CONFIG_MU_RA_SUPPORT=y
 CONFIG_DOT11R_FT_SUPPORT=y
 CONFIG_DOT11K_RRM_SUPPORT=y
-# CONFIG_MT_INTERWORKING is not set
-# CONFIG_MAP_SUPPORT is not set
-# CONFIG_OFFCHANNEL_SCAN_FEATURE is not set
-# CONFIG_OCE_SUPPORT is not set
+#CONFIG_INTERWORKING=y
+#CONFIG_MAP_SUPPORT=y
+#CONFIG_MAP_R2_VER_SUPPORT=y
+#CONFIG_OFFCHANNEL_SCAN_FEATURE=y
+#CONFIG_OCE_SUPPORT=y
 # CONFIG_DPP_FEATURE is not set
 # CONFIG_ENTERPRISE_AP_SUPPORT is not set
 # CONFIG_CFG80211_SUPPORT is not set
@@ -1515,32 +1524,43 @@ CONFIG_DOT11K_RRM_SUPPORT=y
 # CONFIG_DSCP_PRI_SUPPORT is not set
 # CONFIG_MIN_PHY_RATE_SUPPORT is not set
 # CONFIG_FAST_UP_RATE_SUPPORT is not set
+#CONFIG_CON_WPS_SUPPORT=y
+#CONFIG_LLTD_SUPPORT=y
 CONFIG_MCAST_RATE_SPECIFIC=y
 CONFIG_VOW_SUPPORT=y
 CONFIG_BAND_STEERING=y
 CONFIG_LED_CONTROL_SUPPORT=y
 CONFIG_WLAN_HOOK=y
 # CONFIG_RADIUS_ACCOUNTING_SUPPORT is not set
-# CONFIG_GREENAP_SUPPORT is not set
-# CONFIG_PCIE_ASPM_DYM_CTRL_SUPPORT is not set
+#CONFIG_GREENAP_SUPPORT=y
+#CONFIG_PCIE_ASPM_DYM_CTRL_SUPPORT=y
 # CONFIG_COEX_SUPPORT is not set
 # CONFIG_EASY_SETUP_SUPPORT is not set
 # CONFIG_EVENT_NOTIFIER_SUPPORT is not set
-# CONFIG_AIR_MONITOR is not set
+#CONFIG_AIR_MONITOR=y
 CONFIG_WNM_SUPPORT=y
 CONFIG_WPA3_SUPPORT=y
+# CONFIG_WPA3_SUPPORT is not set
 CONFIG_OWE_SUPPORT=y
 # CONFIG_VENDOR_FEATURE10_SUPPORT is not set
 # CONFIG_VENDOR_FEATURE11_SUPPORT is not set
+# CONFIG_RCSA_SUPPORT is not set
 CONFIG_MT_MAC=y
-# CONFIG_WL_TI is not set
+#CONFIG_WAPP_SUPPORT=y
+#CONFIG_WIFI_MT_MAC=y
+#CONFIG_WL_TI=y
 
 #
 # Enable WiMAX (Networking options) to see the WiMAX drivers
 #
 # CONFIG_WAN is not set
 # CONFIG_VMXNET3 is not set
-# CONFIG_ISDN is not set
+#CONFIG_ISDN=y
+# CONFIG_ISDN_I4L is not set
+# CONFIG_ISDN_CAPI is not set
+# CONFIG_ISDN_DRV_GIGASET is not set
+# CONFIG_HYSDN is not set
+# CONFIG_MISDN is not set
 # CONFIG_NVM is not set
 
 #
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/Kconfig b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/Kconfig
index b2b048de..c8c96963 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/Kconfig
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/Kconfig
@@ -71,18 +71,20 @@ config MT_DFS_SUPPORT
         bool "Dynamic Frequency Selection Support"	
         depends on WIFI_DRIVER
         default y
-config MTK_OFFCHANNEL_SCAN_FEATURE
+
+config OFFCHANNEL_SCAN_FEATURE
 	bool "Channel Quality Monitor"
-	depends on MTK_WIFI_DRIVER
-	depends on MTK_MT_AP_SUPPORT
+	depends on WIFI_DRIVER
+	depends on MT_AP_SUPPORT
 	default n
 
-config MTK_DPP_SUPPORT
+config DPP_SUPPORT
 	bool "DPP Support"
-	depends on MTK_WIFI_DRIVER
-	depends on MTK_MT_AP_SUPPORT
+	depends on WIFI_DRIVER
+	depends on MT_AP_SUPPORT
 	select DOT11W_PMF_SUPPORT
 	default n
+
 #config WFA_VHT_R2_PF
 #    bool "WFA VHT R2 Plugfest"
 #    depends on DOT11_VHT_AC
@@ -371,11 +373,7 @@ endmenu
 
 menu "WiFi Operation Modes"
     if WIFI_MODE_AP || WIFI_MODE_BOTH
-		source "drivers/net/wireless/mtk/mt7615e/mt_wifi_ap/Kconfig"
-    endif
-
-    if WIFI_MODE_STA || WIFI_MODE_BOTH
-		source "drivers/net/wireless/mtk/mt7615e/mt_wifi_sta/Kconfig"
+		source "drivers/net/wireless/mediatek/mt7615_ap/Kconfig"
     endif
 endmenu	
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap.c
index 24233dca..ce24d07c 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap.c
@@ -1558,8 +1558,10 @@ VOID APStopByBss(RTMP_ADAPTER *pAd, BSS_STRUCT *pMbss)
 #if defined(MESH_SUPPORT) || defined(APCLI_SUPPORT) || defined(BAND_STEERING)
 	INT idx = 0;
 	struct wifi_dev *wdev;
+#ifdef WSC_AP_SUPPORT
 	PWSC_CTRL pWscControl;
 #endif
+#endif
 #ifdef GREENAP_SUPPORT
 	struct greenap_ctrl *greenap = &pAd->ApCfg.greenap;
 #endif /* GREENAP_SUPPORT */
@@ -1595,12 +1597,12 @@ VOID APStopByBss(RTMP_ADAPTER *pAd, BSS_STRUCT *pMbss)
 #endif
 		for (idx = 0; idx < MAX_APCLI_NUM; idx++) {
 			wdev = &pAd->ApCfg.ApCliTab[idx].wdev;
-
+#ifdef WSC_AP_SUPPORT
 			/* WPS cli will disconnect and connect again */
 			pWscControl = &pAd->ApCfg.ApCliTab[idx].wdev.WscControl;
 			if (pWscControl->bWscTrigger == TRUE)
 				continue;
-
+#endif
 			if (wdev->channel == wdev_bss->channel) {
 				UINT8 enable = pAd->ApCfg.ApCliTab[idx].Enable;
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_apcli.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_apcli.c
index 0917f81e..f50e4117 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_apcli.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_apcli.c
@@ -4807,7 +4807,9 @@ BOOLEAN ApCliAutoConnectExec(
 	IN  PRTMP_ADAPTER   pAd,
 	IN struct wifi_dev *wdev)
 {
-	UCHAR			ifIdx, CfgSsidLen, entryIdx;
+	//UCHAR			ifIdx, CfgSsidLen, entryIdx;
+	UCHAR           ifIdx, CfgSsidLen;
+	UINT            entryIdx;
 	RTMP_STRING *pCfgSsid;
 	BSS_TABLE		*pScanTab, *pSsidBssTab;
 	POS_COOKIE pObj = (POS_COOKIE) pAd->OS_Cookie;
@@ -5108,6 +5110,23 @@ BOOLEAN ApCliAutoConnectExec(
 #endif /* APCLI_AUTO_BW_TMP */
 		{
 
+#ifdef CONFIG_APSTA_MIXED_SUPPORT                                           
+			/* Enable beacon tx for the bss which is same band with apcli wdev */										 
+			int Index;										   
+			struct wifi_dev *wdevEach;
+													
+			for (Index = 0; Index < WDEV_NUM_MAX; Index++) {															  
+				wdevEach = pAd->wdev_list[Index];															  
+				if (wdevEach == NULL)																			  
+					continue;															 
+				if (wdevEach->pHObj == NULL)																			
+					continue;
+																			   
+				if ((HcGetBandByWdev(wdevEach) == HcGetBandByWdev(wdev)) && wdevEach->bAllowBeaconing && (wdevEach->bcn_buf.bBcnSntReq == FALSE) ) {
+					UpdateBeaconHandler(pAd, wdevEach, BCN_UPDATE_ENABLE_TX);														   
+				}
+			}
+#endif 
 
 #ifdef APCLI_OWE_SUPPORT
 			if (switch_to_owe_channel)
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_assoc.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_assoc.c
index 3bb73406..66a41b68 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_assoc.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_assoc.c
@@ -2466,7 +2466,7 @@ assoc_post:
 		pEntry->IsReassocSta = isReassoc;
 		/* clear txBA bitmap */
 		pEntry->TXBAbitmap = 0;
-
+/*
 		if (pEntry->MaxHTPhyMode.field.MODE >= MODE_HTMIX) {
 			CLIENT_STATUS_SET_FLAG(pEntry, fCLIENT_STATUS_WMM_CAPABLE);
 
@@ -2477,7 +2477,7 @@ assoc_post:
 
 			ba_ori_session_setup(pAd, pEntry, 5, 0, 10, FALSE);
 		}
-
+*/
 #ifdef DOT11R_FT_SUPPORT
 
 		/*	If the length of FTIE field of the (re)association-request frame
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_autoChSel.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_autoChSel.c
index da26ddf2..69359fe5 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_autoChSel.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_autoChSel.c
@@ -74,7 +74,8 @@ ULONG AutoChBssSearchWithSSID(
 	IN UCHAR Channel,
 	IN struct wifi_dev *pwdev)
 {
-	UCHAR i;
+	//UCHAR i;
+	UINT i;
 	UCHAR BandIdx = HcGetBandByWdev(pwdev);
 	AUTO_CH_CTRL *pAutoChCtrl = HcGetAutoChCtrlbyBandIdx(pAd, BandIdx);
 	PBSSINFO pBssInfoTab = pAutoChCtrl->pBssInfoTab;
@@ -2677,7 +2678,7 @@ VOID AutoChSelBuildChannelListFor5G(
 
 			pACSChList[ChIdx].CentralChannel = vht_cent_ch_freq(pACSChList[ChIdx].Channel, VHT_BW_80);
 		} else if ((cfg_vht_bw == VHT_BW_160)
-				   && vht80_channel_group(pAd, pACSChList[ChIdx].Channel)) {
+				   && vht160_channel_group(pAd, pACSChList[ChIdx].Channel)) {
 			pACSChList[ChIdx].Bw = BW_160;
 			idx = 0;
 			count = 0;
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_band_steering.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_band_steering.c
index 118600aa..f67fa887 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_band_steering.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_band_steering.c
@@ -986,6 +986,7 @@ BOOLEAN BndStrg_CheckConnectionReq(
 	}
 
 /* WPS_BandSteering Support */
+#ifdef WSC_AP_SUPPORT
 	{
 		PWSC_CTRL pWscControl;
 
@@ -1016,6 +1017,7 @@ BOOLEAN BndStrg_CheckConnectionReq(
 			}
 		}
 	}
+#endif
 
 	if (table->BndStrgMode == POST_CONNECTION_STEERING) {
 		return TRUE;
@@ -1264,7 +1266,9 @@ void BndStrg_UpdateEntry(PRTMP_ADAPTER pAd,
 			cli_assoc->bVHTCapable = TRUE;
 		cli_assoc->Nss = Nss;
 /* WPS_BandSteering Support */
+#ifdef WSC_AP_SUPPORT
 		cli_assoc->bWpsAssoc = ie_list->bWscCapable;
+#endif
 #ifdef CONFIG_DOT11V_WNM
 		cli_assoc->BTMSupport = pEntry->BssTransitionManmtSupport;
 #endif
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_cfg.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_cfg.c
index 2213f552..6ad795a6 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_cfg.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_cfg.c
@@ -81,7 +81,7 @@ COUNTRY_CODE_TO_COUNTRY_REGION allCountry[] = {
 	{100,	"BG",	"BULGARIA",				TRUE,	A_BAND_REGION_1,	TRUE,	G_BAND_REGION_1},
 	{124,	"CA",	"CANADA",				TRUE,	A_BAND_REGION_0,	TRUE,	G_BAND_REGION_0},
 	{152,	"CL",	"CHILE",				TRUE,	A_BAND_REGION_0,	TRUE,	G_BAND_REGION_1},
-	{156,	"CN",	"CHINA",				TRUE,	A_BAND_REGION_1,	TRUE,	G_BAND_REGION_1},//swrt A_BAND_REGION_4=>A_BAND_REGION_1
+	{156,	"CN",	"CHINA",				TRUE,	A_BAND_REGION_4,	TRUE,	G_BAND_REGION_1},//swrt A_BAND_REGION_4=>A_BAND_REGION_1
 	{170,	"CO",	"COLOMBIA",				TRUE,	A_BAND_REGION_0,	TRUE,	G_BAND_REGION_0},
 	{188,	"CR",	"COSTA RICA",			FALSE,	A_BAND_REGION_0,	TRUE,	G_BAND_REGION_1},
 	{191,	"HR",	"CROATIA",				TRUE,	A_BAND_REGION_2,	TRUE,	G_BAND_REGION_1},
@@ -4901,7 +4901,7 @@ INT RTMPAPSetInformation(
 		break;
 
 	case OID_802_11_VOW_BW_AT_EN: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -4929,7 +4929,7 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_BW_TPUT_EN: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -4957,7 +4957,8 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_ATF_EN: {
-		UCHAR *val, buf[VOW_CMD_STR_LEN];
+		UCHAR *val = NULL;
+		UCHAR buf[VOW_CMD_STR_LEN] = {0};
 
 		os_alloc_mem(val, (UCHAR **)&val, wrq->u.data.length);
 
@@ -4980,7 +4981,8 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_RX_EN: {
-		UCHAR *val, buf[VOW_CMD_STR_LEN];
+		UCHAR *val = NULL;
+		UCHAR buf[VOW_CMD_STR_LEN] = {0};
 
 		os_alloc_mem(val, (UCHAR **)&val, wrq->u.data.length);
 
@@ -5003,7 +5005,7 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_GROUP_MAX_RATE: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -5031,7 +5033,7 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_GROUP_MIN_RATE: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -5059,7 +5061,7 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_GROUP_MAX_RATIO: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -5087,7 +5089,7 @@ INT RTMPAPSetInformation(
 	break;
 
 	case OID_802_11_VOW_GROUP_MIN_RATIO: {
-		P_VOW_UI_CONFIG cfg;
+		P_VOW_UI_CONFIG cfg = NULL;
 		UCHAR buf[VOW_CMD_STR_LEN];
 		UINT8 group;
 
@@ -5285,7 +5287,7 @@ INT RTMPAPSetInformation(
 	case OID_802_11_VENDOR_IE_UPDATE:
 	case OID_802_11_VENDOR_IE_REMOVE:
 	{
-		UCHAR *Buf;
+		UCHAR *Buf = NULL;
 		struct vie_op_data_s *vie_op_data;
 		struct wifi_dev *wdev = &pAd->ApCfg.MBSSID[pObj->ioctl_if].wdev;
 		UINT32 length = 0;
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_ftkd.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_ftkd.c
index 56a665fa..b331bdb7 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_ftkd.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/ap_ftkd.c
@@ -87,8 +87,8 @@
 /* #define FT_KDP_DEBUG */ /* debug messages for FT */
 /* #define FT_KDP_FUNC_TEST */ /* do not check security of bssid for debug*/
 #define TYPE_FUNC
-//#define FT_KDP_DEBUG
-//#define FT_KDP_FUNC_TEST
+//#define FT_KDP_DEBUG
+//#define FT_KDP_FUNC_TEST
 /*#define FT_KDP_EMPTY */ /* empty codes to debug */
 
 #define IAPP_DAEMON_CMD_PARSE(__pInfo, __InfoLen, __PeerIP, __pData, __DataLen)	\
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/apcli_ctrl.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/apcli_ctrl.c
index 1f8ef313..5796e20c 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/apcli_ctrl.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/ap/apcli_ctrl.c
@@ -871,7 +871,9 @@ static VOID ApCliCtrlProbeRspAction(
 	UCHAR CliIdx = 0xFF;
 	REPEATER_CLIENT_ENTRY *pReptCliEntry = NULL;
 #endif /* MAC_REPEATER_SUPPORT */
+#ifdef WSC_AP_SUPPORT
 	PWSC_CTRL           pWscControl;
+#endif
 #ifdef APCLI_AUTO_CONNECT_SUPPORT
 	USHORT apcli_ifIndex = (USHORT)(Elem->Priv);
 #endif /* APCLI_AUTO_CONNECT_SUPPORT */
@@ -912,8 +914,9 @@ static VOID ApCliCtrlProbeRspAction(
 	pApCliEntry = &pAd->ApCfg.ApCliTab[ifIndex];
 	wdev = &pApCliEntry->wdev;
 	pProfile_SecConfig = &wdev->SecConfig;
+#ifdef WSC_AP_SUPPORT
 	pWscControl = &wdev->WscControl;
-
+#endif
 
 #ifdef MAC_REPEATER_SUPPORT
 
@@ -1102,8 +1105,11 @@ per mactable entry */
 #endif
 
 #ifdef APCLI_SAE_SUPPORT
-	if (IS_AKM_SAE_SHA256(pApCliEntry->MlmeAux.AKMMap) &&
-		(pWscControl->bWscTrigger == FALSE)) {
+	if (IS_AKM_SAE_SHA256(pApCliEntry->MlmeAux.AKMMap)
+#ifdef WSC_AP_SUPPORT
+	&& (pWscControl->bWscTrigger == FALSE)
+#endif
+		) {
 		UCHAR if_addr[MAC_ADDR_LEN];
 		UCHAR pmkid[LEN_PMKID];
 		UCHAR pmk[LEN_PMK];
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/cmm_info.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/cmm_info.c
index 672d4729..2bae0e69 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/cmm_info.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/cmm_info.c
@@ -4621,7 +4621,7 @@ VOID RTMPCommSiteSurveyData(
 
 		sprintf(Ssid, "0x");
 
-		for (idx = 0; (idx < 14) && (idx < pBss->SsidLen); idx++)
+		for (idx = 0; (idx < 15) && (idx < pBss->SsidLen); idx++)
 			sprintf(Ssid + 2 + (idx * 2), "%02X", (UCHAR)pBss->Ssid[idx]);
 	}
 
@@ -4673,25 +4673,24 @@ VOID RTMPCommSiteSurveyData(
 	/* Ext Channel*/
 	if (pBss->AddHtInfoLen > 0) {
 		if (pBss->AddHtInfo.AddHtInfo.ExtChanOffset == EXTCHA_ABOVE)
-			sprintf(msg + strlen(msg), "%-7s", "ABOVE ");
+			sprintf(msg + strlen(msg), "%-7s", " ABOVE");
 		else if (pBss->AddHtInfo.AddHtInfo.ExtChanOffset == EXTCHA_BELOW)
-			sprintf(msg + strlen(msg), "%-7s", "BELOW ");
+			sprintf(msg + strlen(msg), "%-7s", " BELOW");
 		else
-			sprintf(msg + strlen(msg), "%-7s", "NONE ");
+			sprintf(msg + strlen(msg), "%-7s", " NONE");
 	} else
-		sprintf(msg + strlen(msg), "%-7s", "NONE ");
+		sprintf(msg + strlen(msg), "%-7s", " NONE");
 
 	/*Network Type		*/
 	if (pBss->BssType == BSS_ADHOC)
-		sprintf(msg + strlen(msg), "%-3s", "Ad ");
+		sprintf(msg + strlen(msg), "%-3s", " Ad");
 	else
-		sprintf(msg + strlen(msg), "%-3s", "In ");
+		sprintf(msg + strlen(msg), "%-3s", " In");
 
 	/* SSID Length */
 //	sprintf(msg + strlen(msg), " %-8d", pBss->SsidLen);
 
-	sprintf(msg + strlen(msg), "\n");
-
+	//sprintf(msg + strlen(msg), "\n");
 	return;
 }
 
@@ -4980,7 +4979,7 @@ VOID RTMPIoctlGetSiteSurvey(
 #ifdef WSC_INCLUDED
 max_len += WPS_LINE_LEN;
 #endif
-//max_len += BCNREP_LINE_LEN;
+max_len += BCNREP_LINE_LEN;
 
 #ifdef APCLI_OWE_SUPPORT
 //max_len += OWETRANSIE_LINE_LEN;
@@ -5048,10 +5047,9 @@ max_len += WPS_LINE_LEN;
 //	sprintf(msg + strlen(msg), "%-4s%-4s%-33s%-20s%-23s%-9s%-7s%-7s%-3s%-8s\n",
 //			"No", "Ch", "SSID", "BSSID", "Security", "Siganl(%)", "W-Mode", " ExtCH", " NT", " SSID_Len");
 	sprintf(msg + strlen(msg), "%-4s%-33s%-20s%-23s%-9s%-12s%-7s%-3s\n",
-			"Ch", "SSID", "BSSID", "Security", "Signal(%)", "W-Mode", "ExtCH", "NT");
-
+			"Ch", "SSID", "BSSID", "Security", "Signal(%)", "W-Mode", " ExtCH", " NT");
 #ifdef WSC_INCLUDED
-	sprintf(msg + strlen(msg) - 1, "%-4s%-5s\n", "WPS", "DPID");
+	sprintf(msg + strlen(msg) - 1, "%-4s%-5s\n", " WPS", " DPID");
 #endif /* WSC_INCLUDED */
 //	sprintf(msg + strlen(msg) - 1, "%-8s\n", " BcnRept");
 #ifdef APCLI_OWE_SUPPORT
@@ -5088,14 +5086,14 @@ max_len += WPS_LINE_LEN;
 
 		/*WPS*/
 		if (pBss->WpsAP & 0x01)
-			sprintf(msg + strlen(msg) - 1, "%-4s", "YES ");
+			sprintf(msg + strlen(msg) - 1, "%-4s", " YES");
 		else
-			sprintf(msg + strlen(msg) - 1, "%-4s", "NO  ");
+			sprintf(msg + strlen(msg) - 1, "%-4s", "  NO");
 
 		if (pBss->WscDPIDFromWpsAP == DEV_PASS_ID_PIN)
-			sprintf(msg + strlen(msg), "%-5s", "PIN ");
+			sprintf(msg + strlen(msg), "%-5s", " PIN");
 		else if (pBss->WscDPIDFromWpsAP == DEV_PASS_ID_PBC)
-			sprintf(msg + strlen(msg), "%-5s", "PBC ");
+			sprintf(msg + strlen(msg), "%-5s", " PBC");
 		else
 			sprintf(msg + strlen(msg), "%-5s", " ");
 
@@ -5305,15 +5303,77 @@ USHORT RTMPGetLastTxRate(PRTMP_ADAPTER pAd, MAC_TABLE_ENTRY *pEntry)
 	return lastTxRate.word;
 }
 
+static VOID
+copy_mac_table_entry(PRTMP_ADAPTER pAd, RT_802_11_MAC_ENTRY *pDst, MAC_TABLE_ENTRY *pEntry)
+{
+	pDst->ApIdx = (UCHAR)pEntry->func_tb_idx;
+	COPY_MAC_ADDR(pDst->Addr, &pEntry->Addr);
+	pDst->Aid = (UCHAR)pEntry->Aid;
+	pDst->Psm = pEntry->PsMode;
+
+#ifdef DOT11_N_SUPPORT
+	pDst->MimoPs = pEntry->MmpsMode;
+#endif /* DOT11_N_SUPPORT */
+
+	/* Fill in RSSI per entry*/
+	pDst->AvgRssi0 = pEntry->RssiSample.AvgRssi[0];
+	pDst->AvgRssi1 = pEntry->RssiSample.AvgRssi[1];
+	pDst->AvgRssi2 = pEntry->RssiSample.AvgRssi[2];
+
+	/* the connected time per entry*/
+	pDst->ConnectedTime = pEntry->StaConnectTime;
+
+	pDst->TxRate.word = RTMPGetLastTxRate(pAd, pEntry);
+	pDst->LastRxRate = pEntry->LastRxRate;
+}
+
 VOID RTMPIoctlGetMacTableStaInfo(
 	IN PRTMP_ADAPTER pAd,
 	IN RTMP_IOCTL_INPUT_STRUCT *wrq)
 {
-	INT i;
+	INT i, MacTabWCID;
 	BOOLEAN need_send = FALSE;
 	RT_802_11_MAC_TABLE *pMacTab = NULL;
 	PRT_802_11_MAC_ENTRY pDst;
 	MAC_TABLE_ENTRY *pEntry;
+	UINT16 wrq_len = wrq->u.data.length;
+	POS_COOKIE pObj = (POS_COOKIE)pAd->OS_Cookie;
+
+	wrq->u.data.length = 0;
+
+#ifdef APCLI_SUPPORT
+	if (pObj->ioctl_if_type == INT_APCLI)
+	{
+		STA_TR_ENTRY *tr_entry;
+		
+		if (wrq_len < sizeof(RT_802_11_MAC_ENTRY))
+			return;
+		if (pObj->ioctl_if >= MAX_APCLI_NUM)
+			return;
+		if (pAd->ApCfg.ApCliTab[pObj->ioctl_if].CtrlCurrState != APCLI_CTRL_CONNECTED)
+			return;
+		MacTabWCID = pAd->ApCfg.ApCliTab[pObj->ioctl_if].MacTabWCID;
+		if (!VALID_WCID(MacTabWCID))
+			return;
+		if (!VALID_TR_WCID(MacTabWCID))
+			return;
+		pEntry = &pAd->MacTab.Content[MacTabWCID];
+		tr_entry = &pAd->MacTab.tr_entry[MacTabWCID];
+		if (IS_ENTRY_APCLI(pEntry) && (pEntry->Sst == SST_ASSOC) && (tr_entry->PortSecured == WPA_802_1X_PORT_SECURED))
+		{
+			RT_802_11_MAC_ENTRY MacEntry;
+			
+			pDst = &MacEntry;
+			copy_mac_table_entry(pAd, pDst, pEntry);
+			
+			wrq->u.data.length = sizeof(RT_802_11_MAC_ENTRY);
+			copy_to_user(wrq->u.data.pointer, pDst, wrq->u.data.length);
+		}
+		
+		return;
+	}
+#endif
+
 	/* allocate memory */
 	os_alloc_mem(NULL, (UCHAR **)&pMacTab, sizeof(RT_802_11_MAC_TABLE));
 
@@ -8882,6 +8942,7 @@ void wifi_dump_info(void)
 
 	MTWF_LOG(DBG_CAT_CFG, DBG_SUBCAT_ALL, DBG_LVL_OFF, ("%s--------------------\n", __func__));
 
+#ifdef MULTI_INF_SUPPORT
 	for (idx = 0; idx < MAX_NUM_OF_INF; idx++) {
 		if (adapt_list[idx]) {
 			pAd = adapt_list[idx];
@@ -8902,6 +8963,7 @@ void wifi_dump_info(void)
 #endif
 		}
 	}
+#endif
 }
 
 INT show_tpinfo_proc(RTMP_ADAPTER *pAd, RTMP_STRING *arg)
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rrm.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rrm.c
index 7effa131..9fbb967d 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rrm.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rrm.c
@@ -739,7 +739,7 @@ VOID RRM_PeerNeighborReqAction(
 			MTWF_LOG(DBG_CAT_PROTO, CATPROTO_RRM, DBG_LVL_TRACE, ("DialogToken=%x\n", DialogToken));
 			snprintf(ssidbuf, sizeof(ssidbuf), "%s", pSsid);
 			ssidbuf[SsidLen] = '\0';
-			MTWF_LOG(DBG_CAT_PROTO, CATPROTO_RRM, DBG_LVL_ERROR, ("pSsid=%s\n", pSsid));
+			MTWF_LOG(DBG_CAT_PROTO, CATPROTO_RRM, DBG_LVL_ERROR, ("pSsid=%s\n", /*pSsid*/ssidbuf));
 			MTWF_LOG(DBG_CAT_PROTO, CATPROTO_RRM, DBG_LVL_TRACE, ("SsidLen=%d\n", SsidLen));
 			RRM_EnqueueNeighborRep(pAd, pEntry, DialogToken, pSsid, SsidLen);
 		}
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rt_channel.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rt_channel.c
index b30dbce6..e6b738c3 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rt_channel.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/rt_channel.c
@@ -693,10 +693,10 @@ CH_DESP Country_CL_ChDesp[] = {
 #endif
 /*China*/
 CH_DESP Country_CN_ChDesp[] = {
-	{ 1,   13, 30, BOTH, FALSE},	/*2402~2482MHz, Ch 1~13,   Max BW: 40 */
-	{ 36,   4, 30, BOTH, FALSE},	/*5170~5250MHz, Ch 36~48, Max BW: 40 */
-	{ 52,   4, 30, BOTH, TRUE},	/*5250~5330MHz, Ch 52~64, Max BW: 40 */
-	{ 149,  5, 30, BOTH, FALSE},	/*5735~5835MHz, Ch 149~165, Max BW: 40 */
+	{ 1,   13, 20, BOTH, FALSE},	/*2402~2482MHz, Ch 1~13,   Max BW: 40 */
+	{ 36,   4, 23, BOTH, FALSE},	/*5170~5250MHz, Ch 36~48, Max BW: 40 */
+	{ 52,   4, 23, BOTH, TRUE},	/*5250~5330MHz, Ch 52~64, Max BW: 40 */
+	{ 149,  5, 33, BOTH, FALSE},	/*5735~5835MHz, Ch 149~165, Max BW: 40 */
 	{ 0},			/* end*/
 };
 /*Colombia*/
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/txs.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/txs.c
index 2e096d34..a27f5b7a 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/txs.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/common/txs.c
@@ -378,8 +378,8 @@ INT32 TxSTypeCtlPerPktType(RTMP_ADAPTER *pAd, UINT8 PktType, UINT8 PktSubType, U
 			else if (WlanIdx >= 64 && WlanIdx < 128)
 				TxSCtl->TxSStatusPerWlanIdx[1] |= (1 << (UINT64)WlanIdx);
 			else {
-				TxSCtl->TxSStatusPerWlanIdx[0] = 0xffffffffffffffff;
-				TxSCtl->TxSStatusPerWlanIdx[1] = 0xffffffffffffffff;
+				TxSCtl->TxSStatusPerWlanIdx[0] = 0xffffffffffffffffLL;
+				TxSCtl->TxSStatusPerWlanIdx[1] = 0xffffffffffffffffLL;
 			}
 
 			TxSType->DumpTxSReport = DumpTxSReport;
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/map.h b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/map.h
index a68fff6a..ef583886 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/map.h
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/map.h
@@ -4,7 +4,7 @@
 
 #include "rtmp_type.h"
 #include "rtmp.h"
-#define ASSOC_REQ_LEN       512 //154
+#define ASSOC_REQ_LEN       512 //154
 #define ASSOC_REQ_LEN_MAX	512
 #define BLOCK_LIST_NUM      128
 #define VENDOR_SPECIFIC_LEN 128
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/oid.h b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/oid.h
index 2c9f0cb3..6fed1aa7 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/oid.h
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/oid.h
@@ -1352,7 +1352,8 @@ typedef struct _RT_802_11_MAC_ENTRY {
 	/*
 		sync with WEB UI's structure for ioctl usage.
 	*/
-#ifndef CUSTOMER_DCC_FEATURE
+#ifndef CUSTOMER_DCC_FEATURE
+//#if 0
 	SHORT StreamSnr[3];				/* BF SNR from RXWI. Units=0.25 dB. 22 dB offset removed */
 	SHORT SoundingRespSnr[3];			/* SNR from Sounding Response. Units=0.25 dB. 22 dB offset removed */
 	/*	SHORT TxPER;	*/					/* TX PER over the last second. Percent */
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/rtmp_def.h b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/rtmp_def.h
index fba17d4d..266c7034 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/rtmp_def.h
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/include/rtmp_def.h
@@ -2129,7 +2129,7 @@ typedef struct _WIFI_NODE_TYPE {
 #define INF_MAIN_DEV_NAME		"rai0"
 #define INF_MBSSID_DEV_NAME		"rai"
 #else
-#if CONFIG_RTPCI_AP_RF_OFFSET == 0x48000
+#if CONFIG_RTPCI_AP_RF_OFFSET == 0x48000 || CONFIG_RT_FIRST_CARD == 7603
 #define INF_MAIN_DEV_NAME		"rai"
 #define INF_MBSSID_DEV_NAME		"rai"
 #else
@@ -2142,7 +2142,7 @@ typedef struct _WIFI_NODE_TYPE {
 #define INF_MSTA_DEV_NAME		"ra"
 
 
-#if CONFIG_RTPCI_AP_RF_OFFSET == 0x48000
+#if CONFIG_RTPCI_AP_RF_OFFSET == 0x48000 || CONFIG_RT_FIRST_CARD == 7603
 #define INF_WDS_DEV_NAME		"wdsi"
 #define INF_APCLI_DEV_NAME		"apclii"
 #define INF_MESH_DEV_NAME		"meshi"
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/mgmt/bss_ops.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/mgmt/bss_ops.c
index 00a8134d..3021f20f 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/mgmt/bss_ops.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/mgmt/bss_ops.c
@@ -572,9 +572,10 @@ VOID BssTableInitByBand(BSS_TABLE *Tab, UCHAR Band)
  */
 ULONG BssTableSearch(BSS_TABLE *Tab, UCHAR *pBssid, UCHAR Channel)
 {
-	UCHAR i;
+	//UCHAR i;
+	UINT i;
 
-	for (i = 0; i < Tab->BssNr && Tab->BssNr < MAX_LEN_OF_BSS_TABLE; i++) {
+	for (i = 0; i < Tab->BssNr && Tab->BssNr <= MAX_LEN_OF_BSS_TABLE; i++) {
 		/*
 			Some AP that support A/B/G mode that may used the same BSSID on 11A and 11B/G.
 			We should distinguish this case.
@@ -596,9 +597,10 @@ ULONG BssSsidTableSearch(
 	IN UCHAR	 SsidLen,
 	IN UCHAR	 Channel)
 {
-	UCHAR i;
+	//UCHAR i;
+	UINT i;
 
-	for (i = 0; i < Tab->BssNr  && Tab->BssNr < MAX_LEN_OF_BSS_TABLE; i++) {
+	for (i = 0; i < Tab->BssNr  && Tab->BssNr <= MAX_LEN_OF_BSS_TABLE; i++) {
 		/* Some AP that support A/B/G mode that may used the same BSSID on 11A and 11B/G.*/
 		/* We should distinguish this case.*/
 		/*		*/
@@ -620,9 +622,10 @@ ULONG BssTableSearchWithSSID(
 	IN UCHAR	 SsidLen,
 	IN UCHAR	 Channel)
 {
-	UCHAR i;
+	//UCHAR i;
+	UINT i;
 
-	for (i = 0; i < Tab->BssNr  && Tab->BssNr < MAX_LEN_OF_BSS_TABLE; i++) {
+	for (i = 0; i < Tab->BssNr  && Tab->BssNr <= MAX_LEN_OF_BSS_TABLE; i++) {
 		if ((((Tab->BssEntry[i].Channel <= 14) && (Channel <= 14)) ||
 			 ((Tab->BssEntry[i].Channel > 14) && (Channel > 14))) &&
 			MAC_ADDR_EQUAL(&(Tab->BssEntry[i].Bssid), Bssid) &&
@@ -638,9 +641,10 @@ ULONG BssTableSearchWithSSID(
 
 ULONG BssSsidTableSearchBySSID(BSS_TABLE *Tab, UCHAR *pSsid, UCHAR SsidLen)
 {
-	UCHAR i;
+	//UCHAR i;
+	UINT i;
 
-	for (i = 0; i < Tab->BssNr  && Tab->BssNr < MAX_LEN_OF_BSS_TABLE; i++) {
+	for (i = 0; i < Tab->BssNr  && Tab->BssNr <= MAX_LEN_OF_BSS_TABLE; i++) {
 		if (SSID_EQUAL(pSsid, SsidLen, Tab->BssEntry[i].Ssid, Tab->BssEntry[i].SsidLen))
 			return i;
 	}
@@ -651,9 +655,10 @@ ULONG BssSsidTableSearchBySSID(BSS_TABLE *Tab, UCHAR *pSsid, UCHAR SsidLen)
 
 VOID BssTableDeleteEntry(BSS_TABLE *Tab, UCHAR *pBssid, UCHAR Channel)
 {
-	UCHAR i, j;
+	//UCHAR i, j;
+	UINT i, j;
 
-	for (i = 0; i < Tab->BssNr && Tab->BssNr < MAX_LEN_OF_BSS_TABLE; i++) {
+	for (i = 0; i < Tab->BssNr && Tab->BssNr <= MAX_LEN_OF_BSS_TABLE; i++) {
 		if ((Tab->BssEntry[i].Channel == Channel) &&
 			(MAC_ADDR_EQUAL(Tab->BssEntry[i].Bssid, pBssid))) {
 			UCHAR *pOldAddr = NULL;
@@ -1081,8 +1086,8 @@ ULONG BssTableSetEntry(
 			for (i = 0; i < pAd->ApCfg.ApCliNum; i++) {
 				pApCliEntry = &pAd->ApCfg.ApCliTab[i];
 
-				if (MAC_ADDR_EQUAL(pApCliEntry->MlmeAux.Bssid, ie_list->Bssid)
-					|| SSID_EQUAL(pApCliEntry->MlmeAux.Ssid, pApCliEntry->MlmeAux.SsidLen, ie_list->Ssid, ie_list->SsidLen)) {
+				if ((!MAC_ADDR_EQUAL(pApCliEntry->MlmeAux.Bssid, ZERO_MAC_ADDR) && MAC_ADDR_EQUAL(pApCliEntry->MlmeAux.Bssid, ie_list->Bssid))
+					|| (pApCliEntry->MlmeAux.SsidLen> 0 && SSID_EQUAL(pApCliEntry->MlmeAux.Ssid, pApCliEntry->MlmeAux.SsidLen, ie_list->Ssid, ie_list->SsidLen))) {
 					bInsert = TRUE;
 					break;
 				}
@@ -1101,8 +1106,8 @@ ULONG BssTableSetEntry(
 				!OPSTATUS_TEST_FLAG(pAd, fOP_STATUS_MEDIA_STATE_CONNECTED) ||
 #endif
 				!OPSTATUS_TEST_FLAG(pAd, fOP_AP_STATUS_MEDIA_STATE_CONNECTED)) {
-				if (MAC_ADDR_EQUAL(pAd->ScanCtrl.Bssid, ie_list->Bssid) ||
-					SSID_EQUAL(pAd->ScanCtrl.Ssid, pAd->ScanCtrl.SsidLen, ie_list->Ssid, ie_list->SsidLen)
+				if ((!MAC_ADDR_EQUAL(pAd->ScanCtrl.Bssid, ZERO_MAC_ADDR) && MAC_ADDR_EQUAL(pAd->ScanCtrl.Bssid, ie_list->Bssid)) ||
+					(pAd->ScanCtrl.SsidLen > 0 && SSID_EQUAL(pAd->ScanCtrl.Ssid, pAd->ScanCtrl.SsidLen, ie_list->Ssid, ie_list->SsidLen))
 #ifdef APCLI_SUPPORT
 					|| bInsert
 #endif /* APCLI_SUPPORT */
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/security/crypt_sha2.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/security/crypt_sha2.c
index 35a66202..38fb62d3 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/security/crypt_sha2.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/embedded/security/crypt_sha2.c
@@ -95,30 +95,30 @@ static const UINT32 SHA256_DefaultHashValue[8] = {
 #define Sigma_512_1(x)  (ROTR64(x, 19) ^ ROTR64(x, 61) ^ SHR(x, 6))
 /* SHA384 constants */
 static const UINT64 SHA384_K[80] = {
-	0x428a2f98d728ae22, 0x7137449123ef65cd, 0xb5c0fbcfec4d3b2f, 0xe9b5dba58189dbbc,
-	0x3956c25bf348b538, 0x59f111f1b605d019, 0x923f82a4af194f9b, 0xab1c5ed5da6d8118,
-	0xd807aa98a3030242, 0x12835b0145706fbe, 0x243185be4ee4b28c, 0x550c7dc3d5ffb4e2,
-	0x72be5d74f27b896f, 0x80deb1fe3b1696b1, 0x9bdc06a725c71235, 0xc19bf174cf692694,
-	0xe49b69c19ef14ad2, 0xefbe4786384f25e3, 0x0fc19dc68b8cd5b5, 0x240ca1cc77ac9c65,
-	0x2de92c6f592b0275, 0x4a7484aa6ea6e483, 0x5cb0a9dcbd41fbd4, 0x76f988da831153b5,
-	0x983e5152ee66dfab, 0xa831c66d2db43210, 0xb00327c898fb213f, 0xbf597fc7beef0ee4,
-	0xc6e00bf33da88fc2, 0xd5a79147930aa725, 0x06ca6351e003826f, 0x142929670a0e6e70,
-	0x27b70a8546d22ffc, 0x2e1b21385c26c926, 0x4d2c6dfc5ac42aed, 0x53380d139d95b3df,
-	0x650a73548baf63de, 0x766a0abb3c77b2a8, 0x81c2c92e47edaee6, 0x92722c851482353b,
-	0xa2bfe8a14cf10364, 0xa81a664bbc423001, 0xc24b8b70d0f89791, 0xc76c51a30654be30,
-	0xd192e819d6ef5218, 0xd69906245565a910, 0xf40e35855771202a, 0x106aa07032bbd1b8,
-	0x19a4c116b8d2d0c8, 0x1e376c085141ab53, 0x2748774cdf8eeb99, 0x34b0bcb5e19b48a8,
-	0x391c0cb3c5c95a63, 0x4ed8aa4ae3418acb, 0x5b9cca4f7763e373, 0x682e6ff3d6b2b8a3,
-	0x748f82ee5defb2fc, 0x78a5636f43172f60, 0x84c87814a1f0ab72, 0x8cc702081a6439ec,
-	0x90befffa23631e28, 0xa4506cebde82bde9, 0xbef9a3f7b2c67915, 0xc67178f2e372532b,
-	0xca273eceea26619c, 0xd186b8c721c0c207, 0xeada7dd6cde0eb1e, 0xf57d4f7fee6ed178,
-	0x06f067aa72176fba, 0x0a637dc5a2c898a6, 0x113f9804bef90dae, 0x1b710b35131c471b,
-	0x28db77f523047d84, 0x32caab7b40c72493, 0x3c9ebe0a15c9bebc, 0x431d67c49c100d4c,
-	0x4cc5d4becb3e42b6, 0x597f299cfc657e2a, 0x5fcb6fab3ad6faec, 0x6c44198c4a475817
+	0x428a2f98d728ae22LL, 0x7137449123ef65cdLL, 0xb5c0fbcfec4d3b2fLL, 0xe9b5dba58189dbbcLL,
+	0x3956c25bf348b538LL, 0x59f111f1b605d019LL, 0x923f82a4af194f9bLL, 0xab1c5ed5da6d8118LL,
+	0xd807aa98a3030242LL, 0x12835b0145706fbeLL, 0x243185be4ee4b28cLL, 0x550c7dc3d5ffb4e2LL,
+	0x72be5d74f27b896fLL, 0x80deb1fe3b1696b1LL, 0x9bdc06a725c71235LL, 0xc19bf174cf692694LL,
+	0xe49b69c19ef14ad2LL, 0xefbe4786384f25e3LL, 0x0fc19dc68b8cd5b5LL, 0x240ca1cc77ac9c65LL,
+	0x2de92c6f592b0275LL, 0x4a7484aa6ea6e483LL, 0x5cb0a9dcbd41fbd4LL, 0x76f988da831153b5LL,
+	0x983e5152ee66dfabLL, 0xa831c66d2db43210LL, 0xb00327c898fb213fLL, 0xbf597fc7beef0ee4LL,
+	0xc6e00bf33da88fc2LL, 0xd5a79147930aa725LL, 0x06ca6351e003826fLL, 0x142929670a0e6e70LL,
+	0x27b70a8546d22ffcLL, 0x2e1b21385c26c926LL, 0x4d2c6dfc5ac42aedLL, 0x53380d139d95b3dfLL,
+	0x650a73548baf63deLL, 0x766a0abb3c77b2a8LL, 0x81c2c92e47edaee6LL, 0x92722c851482353bLL,
+	0xa2bfe8a14cf10364LL, 0xa81a664bbc423001LL, 0xc24b8b70d0f89791LL, 0xc76c51a30654be30LL,
+	0xd192e819d6ef5218LL, 0xd69906245565a910LL, 0xf40e35855771202aLL, 0x106aa07032bbd1b8LL,
+	0x19a4c116b8d2d0c8LL, 0x1e376c085141ab53LL, 0x2748774cdf8eeb99LL, 0x34b0bcb5e19b48a8LL,
+	0x391c0cb3c5c95a63LL, 0x4ed8aa4ae3418acbLL, 0x5b9cca4f7763e373LL, 0x682e6ff3d6b2b8a3LL,
+	0x748f82ee5defb2fcLL, 0x78a5636f43172f60LL, 0x84c87814a1f0ab72LL, 0x8cc702081a6439ecLL,
+	0x90befffa23631e28LL, 0xa4506cebde82bde9LL, 0xbef9a3f7b2c67915LL, 0xc67178f2e372532bLL,
+	0xca273eceea26619cLL, 0xd186b8c721c0c207LL, 0xeada7dd6cde0eb1eLL, 0xf57d4f7fee6ed178LL,
+	0x06f067aa72176fbaLL, 0x0a637dc5a2c898a6LL, 0x113f9804bef90daeLL, 0x1b710b35131c471bLL,
+	0x28db77f523047d84LL, 0x32caab7b40c72493LL, 0x3c9ebe0a15c9bebcLL, 0x431d67c49c100d4cLL,
+	0x4cc5d4becb3e42b6LL, 0x597f299cfc657e2aLL, 0x5fcb6fab3ad6faecLL, 0x6c44198c4a475817LL
 };
 static const UINT64 SHA384_DefaultHashValue[8] = {
-	0xcbbb9d5dc1059ed8, 0x629a292a367cd507, 0x9159015a3070dd17, 0x152fecd8f70e5939,
-	0x67332667ffc00b31, 0x8eb44a8768581511, 0xdb0c2e0d64f98fa7, 0x47b5481dbefa4fa4
+	0xcbbb9d5dc1059ed8LL, 0x629a292a367cd507LL, 0x9159015a3070dd17LL, 0x152fecd8f70e5939LL,
+	0x67332667ffc00b31LL, 0x8eb44a8768581511LL, 0xdb0c2e0d64f98fa7LL, 0x47b5481dbefa4fa4LL
 };
 #endif /* SHA384_SUPPORT */
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_drv.h b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_drv.h
index cdccff14..ab684c20 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_drv.h
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_drv.h
@@ -84,7 +84,7 @@ typedef VOID	pregs;
 
 
 #ifdef SINGLE_SKU_V2
-#define SINGLE_SKU_TABLE_FILE_NAME	"/ra_SKU/SingleSKU_mt7615e-sku.dat"
+#define SINGLE_SKU_TABLE_FILE_NAME	"/etc/Wireless/RT2870STA/SingleSKU.dat"
 #endif /* SINGLE_SKU_V2 */
 
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_linux.h b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_linux.h
index 2afd806e..f7c376e7 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_linux.h
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/include/os/rt_linux.h
@@ -145,7 +145,7 @@ typedef struct usb_ctrlrequest devctrlrequest;
 #ifdef INTELP6_SUPPORT
 #define L1_PROFILE_PATH	"/tmp/l1profile.dat"
 #else
-#define L1_PROFILE_PATH	"/etc/wireless/l1profile.dat"
+#define L1_PROFILE_PATH	"/etc_ro/Wireless/l1profile.dat"
 #endif
 #define L1PROFILE_INDEX_LEN		10
 #define	L1PROFILE_ATTRNAME_LEN	30
@@ -191,8 +191,8 @@ typedef struct usb_ctrlrequest devctrlrequest;
 #define BF_GAIN_TABLE_FILE_NAME     "/tmp/.mt7615_SingleSKU_BF_Gain.dat"
 #define BF_SKU_TABLE_FILE_NAME      "/tmp/.mt7615_SingleSKU_BF.dat"
 #else
-#define SINGLE_SKU_TABLE_FILE_NAME	"/ra_SKU/SingleSKU_mt7615e-sku.dat"
-#define BF_SKU_TABLE_FILE_NAME      "/ra_SKU/SingleSKU_mt7615e-sku-bf.dat"
+#define SINGLE_SKU_TABLE_FILE_NAME	"/etc_ro/Wireless/RT2860AP/SingleSKU_mt7615e-sku.dat"
+#define BF_SKU_TABLE_FILE_NAME      "/etc_ro/Wireless/RT2860AP/SingleSKU_mt7615e-sku-bf.dat"
 #endif
 #endif /* SINGLE_SKU_V2 */
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/os/linux/rt_linux.c b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/os/linux/rt_linux.c
index 83682c8e..90b6e380 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/os/linux/rt_linux.c
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615/os/linux/rt_linux.c
@@ -2495,7 +2495,9 @@ VOID RtmpOsPktNatMagicTag(IN PNDIS_PACKET pNetPkt)
 {
 	struct sk_buff *pRxPkt = RTPKT_TO_OSPKT(pNetPkt);
 
-	FOE_MAGIC_TAG(pRxPkt) = FOE_MAGIC_WLAN;
+	FOE_ALG_HEAD(pRxPkt) = 1;
+	FOE_MAGIC_TAG_HEAD(pRxPkt) = FOE_MAGIC_WLAN;
+	FOE_TAG_PROTECT_HEAD(pRxPkt) = TAG_PROTECT;
 }
 #endif /*CONFIG_FAST_NAT_SUPPORT*/
 
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Kconfig b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Kconfig
index 5137ff5d..91f7181c 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Kconfig
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Kconfig
@@ -1,3 +1,7 @@
+config MT7615_AP
+	tristate "MT7615 AP support"
+	select MT_AP_SUPPORT
+
 config MT_AP_SUPPORT
 	tristate "MTK AP support"
 #	depends on NET_RADIO
@@ -37,7 +41,7 @@ config SNIFFER_SUPPORT
 config ANTENNA_CONTROL_SUPPORT
 	bool "Antenna Control"
 	depends on MT_AP_SUPPORT && WIFI_EAP_FEATURE
-	default y
+	default n
 
 config MGMT_TXPWR_CTRL
 	bool "Mgmt TxPower Control"
@@ -148,20 +152,20 @@ config MAP_R2_VER_SUPPORT
 config OFFCHANNEL_SCAN_FEATURE
         bool "Channel Quality Monitor"
         depends on MT_AP_SUPPORT
-        default y
+        default n
 
 config OCE_SUPPORT
         bool "Optimized Connectivity Experience Support"
         depends on MT_AP_SUPPORT
         depends on CHIP_MT7615E
-        select WAPP_SUPPORT
-        default y
+#        select WAPP_SUPPORT
+        default n
 
-#config DPP_FEATURE
-#        bool "DPP Support"
-#        depends on MT_AP_SUPPORT
-#	depends on WIFI_DRIVER
-#        default n
+config DPP_FEATURE
+        bool "DPP Support"
+        depends on MT_AP_SUPPORT
+	depends on WIFI_DRIVER
+        default n
 
 config ENTERPRISE_AP_SUPPORT
 	bool "Enterprise AP Support"
@@ -250,9 +254,9 @@ config CON_WPS_SUPPORT
 #	depends on MULTI_INF_SUPPORT
 	default n
 
-config LLTD_SUPPORT
-	bool "LLTD (Link Layer Topology Discovery Protocol)"
-	depends on MT_AP_SUPPORT
+#config LLTD_SUPPORT
+#	bool "LLTD (Link Layer Topology Discovery Protocol)"
+#	depends on MT_AP_SUPPORT
 
 #config COC_SUPPORT
 #	bool "CoC Support"
diff --git a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Makefile b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Makefile
index 9f1e2e37..cb38c97e 100644
--- a/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Makefile
+++ b/trunk/linux-4.4.x/drivers/net/wireless/mediatek/mt7615_ap/Makefile
@@ -1,21 +1,16 @@
 ifeq ($(CONFIG_SUPPORT_OPENWRT),y)
 WIFI_DRV_PATH := $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))/..
 else
-ifeq ($(CONFIG_DEFAULTS_KERNEL_4_4),y)
-WIFI_DRV_PATH = drivers/net/wireless/mediatek
-else
-WIFI_DRV_PATH = drivers/net/wireless/mtk/mt7615e
-endif
+WIFI_DRV_PATH = drivers/net/wireless/mediatek/mt7615
 endif
 
-GLOBAL_DEFINES = include/uapi/linux/wapp
-EXTRA_CFLAGS = -I$(WIFI_DRV_PATH)/mt_wifi/include \
-				-I$(WIFI_DRV_PATH)/mt_wifi/embedded/include \
-				-I$(WIFI_DRV_PATH)/mt_wifi/ate/include \
-				-I$(WIFI_DRV_PATH)/mt_wifi/include/mcu -I$(GLOBAL_DEFINES)
+EXTRA_CFLAGS = -I$(WIFI_DRV_PATH)/include \
+				-I$(WIFI_DRV_PATH)/embedded/include \
+				-I$(WIFI_DRV_PATH)/ate/include \
+				-I$(WIFI_DRV_PATH)/include/mcu
 
 #DRV_NAME = mt_wifi
-DRV_NAME = mt_wifi_7615E
+DRV_NAME = mt_7615e
 ifeq ($(CONFIG_SUPPORT_OPENWRT),y)
 ifeq ($(CONFIG_CHIP_MT7622),y)
 ifeq ($(CONFIG_MT76XX_COMBO_DUAL_DRIVER_SUPPORT),y)
@@ -25,8 +20,8 @@ endif
 endif
 endif
 
-SRC_DIR = ../mt_wifi
-SRC_EMBEDDED_DIR = ../mt_wifi/embedded
+SRC_DIR = ../mt7615
+SRC_EMBEDDED_DIR = ../mt7615/embedded
 ifeq ($(CONFIG_SUPPORT_OPENWRT),y)
 EXTRA_CFLAGS += -DCONFIG_SUPPORT_OPENWRT
 ifneq ($(CONFIG_RT_FIRST_CARD),)
@@ -1053,21 +1048,21 @@ EXTRA_CFLAGS += -DRELEASE_EXCLUDE
 EXTRA_CFLAGS += -DPRE_CAL_TRX_SET1_SUPPORT
 EXTRA_CFLAGS += -DRLM_CAL_CACHE_SUPPORT
 EXTRA_CFLAGS += -DPRE_CAL_TRX_SET2_SUPPORT
-ifeq ($(CONFIG_SUPPORT_OPENWRT),y)
-CONFIG_PROPRIETARY_DRIVER=y
-ifeq ($(CONFIG_PROPRIETARY_DRIVER),y)
-EXTRA_CFLAGS += -DCONFIG_PROPRIETARY_DRIVER
-CONFIG_PLATFORM_DRV_SUPPORT=n
-else
+#ifeq ($(CONFIG_SUPPORT_OPENWRT),y)
+#CONFIG_PROPRIETARY_DRIVER=y
+#ifeq ($(CONFIG_PROPRIETARY_DRIVER),y)
+#EXTRA_CFLAGS += -DCONFIG_PROPRIETARY_DRIVER
+#CONFIG_PLATFORM_DRV_SUPPORT=n
+#else
 CONFIG_PLATFORM_DRV_SUPPORT=y
-endif
-endif
+#endif
+#endif
 
 ifeq ($(CONFIG_CUSTOMER_VENDOR_IE_SUPPORT),y)
     EXTRA_CFLAGS += -DCUSTOMER_VENDOR_IE_SUPPORT
 endif
 
-CONFIG_OCE_SUPPORT=y
+#CONFIG_OCE_SUPPORT=y
 # OCE
 ifeq ($(CONFIG_OCE_SUPPORT),y)
 EXTRA_CFLAGS += -DOCE_SUPPORT -DOCE_FILS_SUPPORT
@@ -1170,7 +1165,7 @@ EXTRA_CFLAGS += -DHW_TX_AMSDU_SUPPORT
 #WFLAGS += -DMSP_UTILITY
 
 #EXTRA_CFLAGS += -Wframe-larger-than=4096
-WFLAGS += -Werror
+#WFLAGS += -Werror
 
 ifeq ($(CONFIG_HDR_TRANS_TX_SUPPORT),y)
 	EXTRA_CFLAGS += -DHDR_TRANS_TX_SUPPORT -DCUT_THROUGH_FULL_OFFLOAD
@@ -1289,7 +1284,7 @@ ifeq ($(CONFIG_PLATFORM_DRV_SUPPROT),y)
 EXTRA_CFLAGS += -DPLATFORM_DRIVER_SUPPORT
 endif
 
-EXTRA_CFLAGS += -Werror
+#EXTRA_CFLAGS += -Werror
 ifeq ($(CONFIG_HDR_TRANS_TX_SUPPORT),y)
         EXTRA_CFLAGS += -DHDR_TRANS_TX_SUPPORT -DCUT_THROUGH_FULL_OFFLOAD
 endif
@@ -1354,7 +1349,6 @@ EXTRA_CFLAGS += -DCONFIG_WIFI_MTD
 endif
 endif
 else
-ifeq ($(CONFIG_DEFAULTS_KERNEL_4_4),y)
 ifeq ($(CONFIG_MTD_SPI_NOR),y)
 EXTRA_CFLAGS += -DCONFIG_WIFI_MTD
 else
@@ -1364,7 +1358,6 @@ endif
 endif
 endif
 endif
-endif
 
 ifeq ($(CONFIG_DEFAULTS_MEDIATEK_MT7622),y)
 EXTRA_CFLAGS += -DCONFIG_WIFI_MTD
@@ -1512,6 +1505,8 @@ EXTRA_CFLAGS += -DMT_WIFI_MODULE
 endif
 endif
 
+EXTRA_CFLAGS += -DVENDOR_FEATURE6_SUPPORT
+
 MODULE_FLAGS=$(EXTRA_CFLAGS)
 export MODULE_FLAGS
-obj-m+=$(SRC_EMBEDDED_DIR)/plug_in/
+#obj-m+=$(SRC_EMBEDDED_DIR)/plug_in/
diff --git a/trunk/linux-4.4.x/include/net/ra_nat.h b/trunk/linux-4.4.x/include/net/ra_nat.h
index 687de201..8bd077b8 100644
--- a/trunk/linux-4.4.x/include/net/ra_nat.h
+++ b/trunk/linux-4.4.x/include/net/ra_nat.h
@@ -314,14 +314,14 @@ struct cb_rx_desc_info4 {
 #if defined(CONFIG_ARCH_MT7622_WIFI_HW_NAT)
 #define WIFI_INFO_LEN		    3
 #else
-#define WIFI_INFO_LEN		    0
+#define WIFI_INFO_LEN		    0
 #endif
 #if defined(CONFIG_RA_HW_NAT_PPTP_L2TP)
 #define FOE_INFO_LEN		    (10 + WIFI_INFO_LEN)
 #define FOE_MAGIC_FASTPATH	    0x77
 #define FOE_MAGIC_L2TPPATH	    0x78
 #else
-#define FOE_INFO_LEN		    (6 + WIFI_INFO_LEN)
+#define FOE_INFO_LEN		    (6 + WIFI_INFO_LEN)
 #endif
 
 #define FOE_MAGIC_PCI		    0x73
-- 
2.32.0.windows.2

